<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>地鐵隱藏留言 App</title>
    <style>
        :root { --primary-red: #ff0000; }
        body, html { margin: 0; padding: 0; height: 100%; background: #000; overflow: hidden; font-family: sans-serif; }

        /* App 容器 */
        .app-container { position: relative; width: 100vw; height: 100vh; display: flex; flex-direction: column; }

        /* 影片區域 */
        .viewport { position: relative; flex: 1; overflow: hidden; background: #1a1a1a; cursor: pointer; }
        
        video#train-video { 
            width: 100%; height: 100%; object-fit: cover; 
            display: block; /* 確保影片標籤渲染 */
        }

        /* 物理層：文字座標絕對靜止 */
        .physics-layer {
            position: absolute;
            top: 24%; /* 根據影片綠板高度 */
            left: 0;
            width: 100%;
            height: 35%;
            z-index: 10;
            perspective: 1200px;
            pointer-events: none;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* 梯形變形板：對齊綠板透視 */
        .trapezoid-mask {
            width: 100%; height: 100%;
            display: flex; align-items: center; justify-content: center;
            /* 調整這些數值以對齊影片中的梯形 */
            transform: rotateY(-48deg) skewY(-7deg) translateX(40px);
            transform-origin: center right;
            /* 初始完全遮擋 */
            clip-path: inset(0 0 0 100%); 
        }

        .wall-text {
            color: var(--primary-red);
            font-size: 5rem;
            font-weight: 900;
            white-space: nowrap;
            letter-spacing: 5px;
            filter: blur(0.5px) drop-shadow(4px 4px 8px rgba(0,0,0,0.6));
            opacity: 0.95;
        }

        /* App 輸入條 */
        .input-bar {
            background: rgba(20, 20, 20, 1);
            padding: 15px;
            display: flex;
            gap: 10px;
            z-index: 20;
        }

        input { flex: 1; background: #222; border: 1px solid #444; color: #fff; padding: 12px; border-radius: 20px; outline: none; }
        button { background: #4CAF50; color: white; border: none; padding: 10px 20px; border-radius: 20px; font-weight: bold; }
    </style>
</head>
<body>

<div class="app-container">
    <div class="viewport" onclick="enableVideo()">
        <video id="train-video" playsinline muted>
            <source src="Train.mov" type="video/quicktime">
            <source src="Train.mov" type="video/mp4">
            您的瀏覽器不支持影片格式。
        </video>

        <div class="physics-layer">
            <div id="reveal-gate" class="trapezoid-mask">
                <div id="target-message" class="wall-text">白六愛媽媽</div>
            </div>
        </div>
    </div>

    <div class="input-bar">
        <input type="text" id="userInput" placeholder="輸入留言..." value="白六愛媽媽">
        <button onclick="executeReveal()">播放</button>
    </div>
</div>

<script>
    // 解決部分瀏覽器需要互動才能播放影片的問題
    function enableVideo() {
        const video = document.getElementById('train-video');
        video.play();
        video.pause();
        console.log("Video primed for playback");
    }

    // 留言板揭曉模組
    const MetroApp = {
        config: { start: 3.51, end: 4.9 }, // 根據錄影微調揭曉時間
        
        run: function(msgText) {
            const video = document.getElementById('train-video');
            const gate = document.getElementById('reveal-gate');
            const text = document.getElementById('target-message');
            
            text.innerText = msgText;
            gate.style.transition = 'none';
            gate.style.clipPath = 'inset(0 0 0 100%)'; 
            
            video.currentTime = 0;
            video.play();

            const sync = () => {
                const now = video.currentTime;
                // 物理揭曉邏輯：原地顯現，不隨火車移動
                if (now >= this.config.start && now <= this.config.end) {
                    const p = (now - this.config.start) / (this.config.end - this.config.start);
                    gate.style.clipPath = `inset(0 0 0 ${100 - (p * 100)}%)`;
                } else if (now > this.config.end) {
                    gate.style.clipPath = 'inset(0 0 0 0%)';
                }

                if (!video.paused && !video.ended) requestAnimationFrame(sync);
            };
            requestAnimationFrame(sync);
        }
    };

    function executeReveal() {
        MetroApp.run(document.getElementById('userInput').value);
    }
</script>
</body>
</html>
