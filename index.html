<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>地鐵隱藏留言 App</title>
    <style>
        :root { --primary-red: #ff0000; }
        body, html { margin: 0; padding: 0; height: 100%; background: #000; overflow: hidden; font-family: sans-serif; }

        .app-container { position: relative; width: 100vw; height: 100vh; display: flex; flex-direction: column; }

        /* 影片展示區 */
        .viewport { position: relative; flex: 1; overflow: hidden; }
        video#train-video { width: 100%; height: 100%; object-fit: cover; }

        /* 物理層：文字座標在此絕對靜止 */
        .physics-layer {
            position: absolute;
            top: 22%; /* 根據綠板高度調整 */
            left: 0;
            width: 100%;
            height: 40%;
            z-index: 10;
            perspective: 1000px;
            pointer-events: none;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* 梯形變形板：模擬綠板透視 */
        .trapezoid-mask {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            /* 關鍵：調整 rotateY 與 skewY 達成右大左小的梯形 */
            transform: rotateY(-48deg) skewY(-7.5deg) translateX(40px);
            transform-origin: center right;
            /* 遮罩機制：原本就貼在牆上，只是被遮住 */
            clip-path: inset(0 0 0 100%); 
        }

        .wall-text {
            color: var(--primary-red);
            font-size: 5rem;
            font-weight: 900;
            white-space: nowrap;
            letter-spacing: 5px;
            /* 模擬牆面噴漆質感 */
            filter: blur(0.5px) drop-shadow(4px 4px 8px rgba(0,0,0,0.6));
            opacity: 0.95;
        }

        /* 輸入介面 */
        .input-bar {
            background: rgba(20, 20, 20, 0.95);
            padding: 15px;
            display: flex;
            gap: 10px;
            backdrop-filter: blur(10px);
        }

        input { flex: 1; background: #222; border: 1px solid #444; color: #fff; padding: 12px; border-radius: 20px; outline: none; }
        button { background: #4CAF50; color: white; border: none; padding: 10px 20px; border-radius: 20px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div class="app-container">
    <div class="viewport">
        <video id="train-video" playsinline muted>
            <source src="Train.mov" type="video/quicktime">
            <source src="Train.mov" type="video/mp4">
        </video>

        <div class="physics-layer">
            <div id="reveal-gate" class="trapezoid-mask">
                <div id="target-message" class="wall-text">白六愛媽媽</div>
            </div>
        </div>
    </div>

    <div class="input-bar">
        <input type="text" id="userInput" placeholder="輸入留言..." value="白六愛媽媽">
        <button onclick="executeReveal()">播放</button>
    </div>
</div>

<script>
    // 封裝成留言板模組 (Module Concept)
    const MetroBoard = {
        config: { start: 3.51, end: 5.0 },
        
        run: function(msg) {
            const video = document.getElementById('train-video');
            const gate = document.getElementById('reveal-gate');
            const text = document.getElementById('target-message');
            
            text.innerText = msg;
            gate.style.transition = 'none';
            gate.style.clipPath = 'inset(0 0 0 100%)'; // 重置為完全遮擋
            
            video.currentTime = 0;
            video.play();

            const sync = () => {
                const now = video.currentTime;
                if (now >= this.config.start && now <= this.config.end) {
                    const p = (now - this.config.start) / (this.config.end - this.config.start);
                    // 遮罩邊界從 100% 縮減到 0% (原地揭曉)
                    gate.style.clipPath = `inset(0 0 0 ${100 - (p * 100)}%)`;
                } else if (now > this.config.end) {
                    gate.style.clipPath = 'inset(0 0 0 0%)';
                }

                if (!video.paused && !video.ended) requestAnimationFrame(sync);
            };
            requestAnimationFrame(sync);
        }
    };

    function executeReveal() {
        const val = document.getElementById('userInput').value;
        MetroBoard.run(val);
    }
</script>
</body>
</html>
