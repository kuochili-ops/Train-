<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>地鐵隱藏留言 App</title>
    <style>
        body {
            margin: 0;
            background: #1a1a1a;
            font-family: "Microsoft JhengHei", sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            color: white;
            overflow: hidden;
        }

        .container {
            position: relative;
            width: 100%;
            max-width: 500px;
            aspect-ratio: 9 / 16;
            background: #000;
            overflow: hidden;
        }

        video#bg-video {
            position: absolute;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 1;
        }

        /* 物理貼合層：負責處理梯形透視 */
        .perspective-layer {
            position: absolute;
            top: 28%; /* 調整至綠板高度 */
            left: 0;
            width: 100%;
            height: 30%;
            z-index: 5;
            perspective: 1000px; /* 建立 3D 深度 */
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: none;
        }

        /* 梯形面板：這就是你說的「依照綠板外型做變形」 */
        .trapezoid-board {
            width: 90%;
            display: flex;
            justify-content: center;
            /* 調整以下參數以對齊綠板邊緣 */
            /* rotateY: 牆面深度, skewY: 平行修正 */
            transform: rotateY(-45deg) skewY(-7deg) translateX(30px);
            transform-origin: center right;
            
            /* 核心遮罩：一開始由左往右遮住 (100%) */
            /* 隨著火車開走，這份 inset 會縮減，讓圖顯現出來 */
            clip-path: inset(0 0 0 100%); 
        }

        .text-strip {
            color: #ff0000; /* 紅色噴漆感 */
            font-size: 3.5rem;
            font-weight: 900;
            white-space: nowrap;
            letter-spacing: 2px;
            /* 增加環境融合感 */
            filter: blur(0.5px) drop-shadow(2px 2px 4px rgba(0,0,0,0.5));
            opacity: 0.9;
        }

        .controls {
            padding: 20px;
            width: 100%;
            max-width: 500px;
            background: #222;
            z-index: 10;
        }

        textarea {
            width: 100%; height: 50px; background: #333; border: 1px solid #444;
            color: white; padding: 10px; border-radius: 8px; resize: none; margin-bottom: 10px;
        }

        button {
            width: 100%; padding: 12px; background: #4CAF50; border: none;
            color: white; border-radius: 8px; cursor: pointer; font-weight: bold;
        }
    </style>
</head>
<body>

    <div class="container">
        <video id="bg-video" playsinline muted>
            <source src="Train.mov" type="video/quicktime">
            <source src="Train.mov" type="video/mp4">
        </video>

        <div class="perspective-layer">
            <div id="mask-gate" class="trapezoid-board">
                <div id="wall-text" class="text-strip">白六愛媽媽</div>
            </div>
        </div>
    </div>

    <div class="controls">
        <textarea id="userInput" placeholder="輸入文字..."></textarea>
        <button onclick="playApp()">播放 App 效果</button>
    </div>

    <script>
        const video = document.getElementById('bg-video');
        const maskGate = document.getElementById('mask-gate');
        const wallText = document.getElementById('wall-text');
        const input = document.getElementById('userInput');

        function playApp() {
            const msg = input.value.trim() || "白六愛媽媽";
            wallText.innerText = msg;

            // 1. 初始化遮罩：完全隱藏 (從左側遮擋 100%)
            maskGate.style.transition = 'none';
            maskGate.style.clipPath = 'inset(0 0 0 100%)';

            video.currentTime = 0;
            video.play();

            // 2. 監控時間：3.51s 開始隨著車尾揭曉
            // 假設車尾在 4.8s 完全離開綠板
            const startTime = 3.51;
            const endTime = 4.8;

            const syncReveal = () => {
                const now = video.currentTime;

                if (now >= startTime && now <= endTime) {
                    // 計算百分比 (0 到 1)
                    const progress = (now - startTime) / (endTime - startTime);
                    // 遮罩邊界從 100% 降到 0%
                    const revealVal = 100 - (progress * 100);
                    maskGate.style.clipPath = `inset(0 0 0 ${revealVal}%)`;
                } else if (now > endTime) {
                    maskGate.style.clipPath = 'inset(0 0 0 0%)';
                }

                if (!video.paused && !video.ended) {
                    requestAnimationFrame(syncReveal);
                }
            };

            requestAnimationFrame(syncReveal);
        }
    </script>
</body>
</html>
