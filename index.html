<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>白六留言 App</title>
    <style>
        body, html { margin: 0; padding: 0; height: 100%; background: #000; font-family: sans-serif; overflow: hidden; }
        
        .app-container { position: relative; width: 100vw; height: 100vh; display: flex; flex-direction: column; }

        /* 影片視窗 */
        .viewport { position: relative; flex: 1; background: #111; overflow: hidden; }
        
        video#train-video { 
            width: 100%; height: 100%; object-fit: cover; 
            /* 預設隱藏直到影片載入完成 */
            background: url('image.png') no-repeat center center;
            background-size: cover;
        }

        /* 物理透視層 */
        .wall-perspective {
            position: absolute;
            top: 25%; /* 對齊綠板高度 */
            left: 0;
            width: 100%;
            height: 35%;
            z-index: 10;
            perspective: 1200px;
            pointer-events: none;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* 模組化遮罩：文字在此原地不動 */
        .trapezoid-mask {
            width: 100%; height: 100%;
            display: flex; align-items: center; justify-content: center;
            /* 針對你截圖中的綠板斜度進行 3D 校正 */
            transform: rotateY(-48deg) skewY(-7deg) translateX(40px);
            transform-origin: center right;
            clip-path: inset(0 0 0 100%); /* 初始隱藏 */
        }

        .red-message {
            color: #ff0000;
            font-size: 5rem;
            font-weight: 900;
            white-space: nowrap;
            letter-spacing: 5px;
            filter: blur(0.5px) drop-shadow(4px 4px 8px rgba(0,0,0,0.6));
            opacity: 0.95;
        }

        /* 下方輸入介面 */
        .ui-bar {
            background: #111;
            padding: 15px;
            display: flex;
            gap: 10px;
            border-top: 1px solid #333;
        }

        input { flex: 1; background: #222; border: none; color: #fff; padding: 12px; border-radius: 20px; outline: none; }
        button { background: #4CAF50; color: white; border: none; padding: 10px 20px; border-radius: 20px; font-weight: bold; }
    </style>
</head>
<body>

<div class="app-container">
    <div class="viewport">
        <video id="train-video" playsinline muted preload="auto">
            <source src="Train.mp4" type="video/mp4">
            <source src="Train.mov" type="video/quicktime">
        </video>

        <div class="wall-perspective">
            <div id="physics-gate" class="trapezoid-mask">
                <div id="app-text" class="red-message">白六愛媽媽</div>
            </div>
        </div>
    </div>

    <div class="ui-bar">
        <input type="text" id="userInput" value="白六愛媽媽">
        <button onclick="MetroApp.play()">播放</button>
    </div>
</div>

<script>
    // 將功能模組化 (Module)
    const MetroApp = {
        video: document.getElementById('train-video'),
        gate: document.getElementById('physics-gate'),
        text: document.getElementById('app-text'),
        input: document.getElementById('userInput'),
        config: { start: 3.51, end: 4.9 },

        play: function() {
            this.text.innerText = this.input.value;
            
            // 重置影片與遮罩
            this.video.currentTime = 0;
            this.gate.style.clipPath = 'inset(0 0 0 100%)';
            
            // 嘗試播放，若失敗則在 Console 報錯
            const playPromise = this.video.play();
            if (playPromise !== undefined) {
                playPromise.catch(error => {
                    console.log("自動播放被攔截，請點擊頁面後再試一次。");
                });
            }

            this.sync();
        },

        sync: function() {
            const update = () => {
                const now = this.video.currentTime;
                if (now >= this.config.start && now <= this.config.end) {
                    const progress = (now - this.config.start) / (this.config.end - this.config.start);
                    // 遮罩從 100% (右) 往 0% (左) 移動，達成揭曉感
                    this.gate.style.clipPath = `inset(0 0 0 ${100 - (progress * 100)}%)`;
                } else if (now > this.config.end) {
                    this.gate.style.clipPath = 'inset(0 0 0 0%)';
                }

                if (!this.video.paused && !this.video.ended) {
                    requestAnimationFrame(update);
                }
            };
            requestAnimationFrame(update);
        }
    };
</script>
</body>
</html>
